<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MitigasiHub v6 - National Champion Edition</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:#f4f7fb;
color:#2c3e50;
transition:0.3s;
}
.dark{
background:#1e1e1e;
color:white;
}
nav{
background:#0b3d91;
color:white;
padding:15px 40px;
display:flex;
justify-content:space-between;
align-items:center;
}
button{
background:#0b3d91;
color:white;
padding:10px 20px;
border:none;
border-radius:6px;
cursor:pointer;
}
button:hover{background:#1565c0;}
.container{
max-width:1200px;
margin:40px auto;
padding:20px;
}
.card{
background:white;
padding:25px;
border-radius:10px;
box-shadow:0 8px 20px rgba(0,0,0,0.08);
margin-bottom:30px;
}
.dark .card{background:#2c2c2c;}
input,select{
width:100%;
padding:8px;
margin:8px 0 20px 0;
border-radius:6px;
border:1px solid #ccc;
}
#map{height:350px;}
footer{
background:#0b3d91;
color:white;
text-align:center;
padding:20px;
margin-top:40px;
}
</style>
</head>

<body>

<nav>
<h2>MitigasiHub v6</h2>
<div>
<button onclick="toggleMode()">Dark Mode</button>
</div>
</nav>

<div class="container">

<div class="card">
<h3>Parameter Input</h3>
<select id="wilayah">
<option>Jakarta Utara</option>
<option>Jakarta Barat</option>
<option>Jakarta Timur</option>
<option>Jakarta Selatan</option>
<option>Jakarta Pusat</option>
</select>
<input type="number" id="hujan" value="200" placeholder="Curah Hujan (mm)">
<input type="number" id="kepadatan" value="15000" placeholder="Kepadatan (jiwa/km²)">
<input type="number" id="elevasi" value="6" placeholder="Elevasi (1-10)">
<select id="skenario">
<option value="1">Normal</option>
<option value="1.3">Siaga</option>
<option value="1.6">Ekstrem</option>
</select>
<button onclick="analisis()">Analisis</button>
<button onclick="downloadPDF()">Export PDF</button>
</div>

<div class="card">
<h3>Risk Gauge</h3>
<canvas id="gauge"></canvas>
<h2 id="scoreText"></h2>
</div>

<div class="card">
<h3>Trend Projection</h3>
<canvas id="trend"></canvas>
</div>

<div class="card">
<h3>Peta Wilayah DKI Jakarta</h3>
<div id="map"></div>
</div>

<div class="card">
<h3>Executive Intelligence Summary</h3>
<p id="summary">Menunggu analisis...</p>
</div>

</div>

<footer>
© 2026 MitigasiHub v6 | Smart Disaster Intelligence Prototype
</footer>

<script>

let gaugeChart, trendChart;
let map = L.map('map').setView([-6.2,106.8],11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

function toggleMode(){
document.body.classList.toggle("dark");
}

function analisis(){

let hujan=parseFloat(document.getElementById("hujan").value);
let kepadatan=parseFloat(document.getElementById("kepadatan").value);
let elevasi=parseFloat(document.getElementById("elevasi").value);
let skenario=parseFloat(document.getElementById("skenario").value);
let wilayah=document.getElementById("wilayah").value;

let hujanNorm=hujan/300;
let kepadatanNorm=kepadatan/20000;
let elevasiRisk=(10-elevasi)/10;

let risk=((0.4*hujanNorm)+(0.3*kepadatanNorm)+(0.2*elevasiRisk)+0.1)*skenario;
let score=Math.min((risk*100).toFixed(2),100);

buatGauge(score);
buatTrend(score);
buatSummary(score,wilayah);
}

function buatGauge(score){
if(gaugeChart) gaugeChart.destroy();
gaugeChart=new Chart(document.getElementById("gauge"),{
type:'doughnut',
data:{labels:["Risk","Remaining"],
datasets:[{data:[score,100-score]}]},
options:{rotation:-90,circumference:180,plugins:{legend:{display:false}}}
});
document.getElementById("scoreText").innerText=score+" / 100";
}

function buatTrend(score){
if(trendChart) trendChart.destroy();
trendChart=new Chart(document.getElementById("trend"),{
type:'line',
data:{labels:["T-3","T-2","T-1","Now","T+1"],
datasets:[{label:"Risk Projection",
data:[score*0.7,score*0.8,score*0.9,score,score*1.1]}]},
options:{scales:{y:{beginAtZero:true,max:100}}}
});
}

function buatSummary(score,wilayah){
let level="Rendah";
if(score>=40 && score<70) level="Sedang";
if(score>=70) level="Tinggi";

document.getElementById("summary").innerText=
"Sistem mendeteksi tingkat risiko "+level+
" pada wilayah "+wilayah+
" dengan skor "+score+
". Direkomendasikan peningkatan kapasitas drainase, optimalisasi early warning system, dan integrasi monitoring berbasis IoT untuk mitigasi jangka menengah.";
}

function downloadPDF(){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.text("MITIGASIHUB v6 - LAPORAN ANALISIS RISIKO",10,10);
doc.text(document.getElementById("summary").innerText,10,20);
doc.save("MitigasiHub_Report.pdf");
}

</script>

</body>
</html>
